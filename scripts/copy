#!/bin/bash
set -e
# å°†æ„å»ºçš„RPMå¤åˆ¶åˆ°yumä»“åº“çš„æœ¬åœ°å‰¯æœ¬ä¸­

BUILD_RPMS_DIR="/usr/src/packages/RPMS"
LOCAL_COPY="copy"

# å¦‚æœæœ¬åœ°å‰¯æœ¬ç›®å½•ä¸­æ²¡æœ‰æ¶æ„å­ç›®å½•ï¼Œåˆ™åˆ›å»º
if [[ ! -d "${LOCAL_COPY}/x86_64" ]]; then
  mkdir "${LOCAL_COPY}/x86_64"
fi

if [[ ! -d "${LOCAL_COPY}/noarch" ]]; then
  mkdir "${LOCAL_COPY}/noarch"
fi

# å¤åˆ¶x86_64
if [[ "$(ls "${BUILD_RPMS_DIR}/x86_64" | wc -l)" -gt 0 ]]; then
    for file in "${BUILD_RPMS_DIR}/x86_64/"*; do
        filename="$(basename "$file")"

        if [[ "$filename" =~ (debugsource|debuginfo) ]]; then
            echo "è·³è¿‡æ–‡ä»¶ï¼š$filename"
        else
            if [[ -e "${LOCAL_COPY}/x86_64/${filename}" ]]; then
                echo "ğŸš¨ è­¦å‘Šï¼šæ­£åœ¨è¦†ç›–æ–‡ä»¶ $filename"
            fi
            cp --force "$file" "${LOCAL_COPY}/x86_64/"
        fi
    done
fi

# å¤åˆ¶noarch
if [[ "$(ls "${BUILD_RPMS_DIR}/noarch" | wc -l)" -gt 0 ]]; then
    for file in "${BUILD_RPMS_DIR}/noarch/"*; do
        filename="$(basename "$file")"
        if [[ -e "${LOCAL_COPY}/noarch/${filename}" ]]; then
            echo "ğŸš¨ è­¦å‘Šï¼šæ­£åœ¨è¦†ç›–æ–‡ä»¶ $filename"
        fi
        cp --force "$file" "${LOCAL_COPY}/noarch/"
    done
fi
